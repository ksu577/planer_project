<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.study.cart.dao.CartDao">

    <!-- 1. 장바구니 추가 -->
    <insert id="insertCart">
        insert into cart (cart_id, user_id, product_id, amount)
        values (seq_cart.nextval, #{userId}, #{product_id}, #{amount})
    </insert>

    <!-- 2. 장바구니 목록 -->
    <select id="CartList" resultType="com.study.cart.vo.CartVO">
        select c.cart_id    as      cartId,
               c.user_id    as      userId,
               p.id as      productId,
               p.name       as      productName,
               m.name       as      userName,
               c.amount,
               p.price      as      productPrice,
               (p.price * c.amount) money
        from member m,
             product p,
             cart c
        where m.id = c.user_id
          and p.id = c.product_id
          and c.user_id = #{userId}
    </select>

    <!-- 3. 장바구니 삭제 -->
    <delete id="delete">
        DELETE
        From cart
        where cart_id = #{cartId}
    </delete>

    <!-- 4. 장바구니 수정 -->
    <update id="modifyCart">
        update cart
        set amount = #{amount}
        where user_id = #{userId}
    </update>

    <!--5. 장바구니 금액 합계-->
    <select id="sumMoney" resultType="int">
        select NVL(SUM(p.price * c.amount) , 0) money
        from cart c, product p
        where c.product_id = p.id and c.user_id = #{userId}
    </select>

    <!--6. 장바구니에 있는 것과 동일한 상품 코드 확인-->
    <select id="CountCart" resultType="int">
        select count(*)
        from cart
        where user_id = #{userId}
          and product_id = #{product_id}
    </select>

    <!-- 7. 장바구니 상품수량 변경 -->
    <update id="updateCart">
        update cart
        set amount = amount + #{amount}
        where user_id = #{userId}
        and product_id = #{product_id}
    </update>


</mapper>