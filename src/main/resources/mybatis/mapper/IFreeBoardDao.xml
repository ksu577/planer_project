<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.study.free.dao.IFreeBoardDao">

    <sql id="searchInFree">
        <if test='!@org.apache.commons.lang3.StringUtils@isBlank(search.searchWord)'>
            <if test='search.searchType=="T"'>
                AND title LIKE '%' || #{search.searchWord} || '%'
            </if>
            <if test='search.searchType=="W"'>
                AND id LIKE '%' || #{search.searchWord} || '%'
            </if>
            <if test='search.searchType=="C"'>
                AND free_context LIKE '%' || #{search.searchWord} || '%'
            </if>
        </if>
        <if test='!@org.apache.commons.lang3.StringUtils@isBlank(searchCategory)'>
            AND title = #{searchCategory}
        </if>
    </sql>




    <select id="getTotalRowCount" resultType="int" parameterType="java.util.Map">
        SELECT  count(*)
        FROM free_board
        WHERE 1=1
        <include refid="searchInFree"  />
    </select>

    <select id="getBoardList" resultType="com.study.free.vo.FreeBoardVO">
        SELECT *
        FROM (SELECT a.*, rownum AS rnum
        FROM
        (
        SELECT
        id,free_num,free_context,
        create_date,update_date,view_rate,
        free_like,title,bo_del_yn
        FROM free_board a
        where 1=1
        <include refid="searchInFree"/>
        ORDER BY free_num desc) a)
        WHERE rnum between #{paging.firstRow} and #{paging.lastRow}

    </select>

    <resultMap id="freeAttaches" type="com.study.free.vo.FreeBoardVO">
        <collection property="attaches" column="{atchParentNO=free_num, atchCategory=bo_type}"
                    ofType="com.study.attach.vo.AttachVO"
                    select="com.study.attach.dao.IAttachDao.getAttachListByParent">
        </collection>
    </resultMap>

    <select id="getBoard" resultType="com.study.free.vo.FreeBoardVO" parameterType="com.study.free.vo.FreeBoardVO">
        SELECT id,free_num,free_context,
               create_date,update_date,view_rate,
               free_like,title
        FROM free_board
        where free_num=#{freeNum}
    </select>



    <update id="updateBoard"
            parameterType="com.study.free.vo.FreeBoardVO">
        UPDATE free_board
        SET title=#{title}
          , free_context = #{freeContext}
        WHERE free_Num = #{freeNum}
    </update>


    <update id="increaseView">
        UPDATE free_board
        SET view_rate = view_rate + 1
        WHERE free_num = #{freeNum}
    </update>


    <delete id="deleteBoard"
            parameterType="com.study.free.vo.FreeBoardVO">
        UPDATE free_board
        SET bo_del_yn = 'Y'
        WHERE id = #{id}
    </delete>


    <insert id="insertBoard" parameterType="com.study.free.vo.FreeBoardVO">
        INSERT INTO free_board (id, free_num, free_context,
                                create_date, update_date, view_rate,
                                free_like, title)
        VALUES (#{id}, seq_free_board.nextval, #{freeContext},
                SYSDATE, SYSTIMESTAMP, #{viewRate},
                #{freeLike}, #{title})
    </insert>


</mapper>